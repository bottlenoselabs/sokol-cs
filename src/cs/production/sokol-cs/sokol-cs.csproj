<Project Sdk="Microsoft.NET.Sdk">

  <!-- pixel-formats-cs-->
  <ItemGroup>
    <Compile Include="$(GitRepositoryPath)ext/pixel-formats-cs/src/*.cs">
      <Link>pixel-formats-cs/%(Filename)%(Extension)</Link>
    </Compile>
  </ItemGroup>
  
  <!-- NuGet references -->
  <ItemGroup>
    <PackageReference Include="C2CS.Runtime" Version="*-*" />
  </ItemGroup>

  <!-- Build sokol native library -->
  <Target Name="BuildNativeLibrary" AfterTargets="Restore" BeforeTargets="BeforeBuild">
    <Exec Command="$(GitRepositoryPath)library.cmd" Condition="'$(OS)' == 'Windows_NT'" WorkingDirectory="$(GitRepositoryPath)" />
    <Exec Command="$(GitRepositoryPath)library.sh" Condition="'$(OS)' != 'Windows_NT'" WorkingDirectory="$(GitRepositoryPath)" />
  </Target>

  <!-- Dynamic link libraries -->
  <ItemGroup>
    <Content Include="$(GitRepositoryPath)lib/*.dll" Condition="'$(IsWindows)' == 'true'">
      <Link>%(Filename)%(Extension)</Link>
      <PackagePath>runtimes/$(RuntimeIdentifier)\native\%(Filename)%(Extension)</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="$(GitRepositoryPath)lib/*.dylib" Condition="'$(IsMacOS)' == 'true'">
      <Link>%(Filename)%(Extension)</Link>
      <PackagePath>runtimes/$(RuntimeIdentifier)/native/%(Filename)%(Extension)</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="$(GitRepositoryPath)lib/*.so" Condition="'$(IsLinux)' == 'true'">
      <Link>%(Filename)%(Extension)</Link>
      <PackagePath>runtimes/$(RuntimeIdentifier)/native/%(Filename)%(Extension)</PackagePath>
      <Pack>true</Pack>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>
  <Target Name="Print native libraries" BeforeTargets="BeforeBuild">
    <Exec Command="ls $(GitRepositoryPath)lib" Condition="'$(OS)' != 'Windows_NT'"  />
    <Exec Command="dir $(GitRepositoryPath)lib" Condition="'$(OS)' == 'Windows_NT'"  />
  </Target>

</Project>
